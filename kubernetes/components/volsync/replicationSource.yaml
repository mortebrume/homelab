---
apiVersion: volsync.backube/v1alpha1
kind: ReplicationSource
metadata:
  name: "${APP}"
spec:
  sourcePVC: "${VOLSYNC_CLAIM:=${APP}}"
  trigger:
    schedule: "30 5 * * *"
  kopia:
    accessModes:
      - "${VOLSYNC_SNAP_ACCESSMODES:=ReadWriteOnce}"
    compression: zstd-best-compression
    copyMethod: Snapshot
    moverSecurityContext:
      runAsUser: "${VOLSYNC_PUID:=1000}"
      runAsGroup: "${VOLSYNC_PGID:=1000}"
      fsGroup: "${VOLSYNC_PGID:=1000}"
      fsGroupChangePolicy: OnRootMismatch
    parallelism: 2
    repository: "${APP}-volsync"
    retain:
      daily: "${VOLSYNC_DAILY_RETENTION:=7}"
      latest: "${VOLSYNC_LATEST_RETENTION:=7}"
    storageClassName: "${VOLSYNC_STORAGECLASS:=zfs-pv}"
    volumeSnapshotClassName: "${VOLSYNC_SNAPSHOTCLASS:=zfs-snap}"
